<html>
<head>
	<title>PassForge password generator</title>
	<meta name="viewport" content="width=device-width" />
	<style type="text/css">
		#progress {
			width: 0px;
			height: 100%;
			background-color: #729fcf;
		}
		#progressContainer {
			width: 200px;
			height: 8px;
			border: 1px solid black;
			margin-bottom: 0.5em;
		}
		#key {
			width: 200px;
		}
		#time {
			margin-left: 1em;
			color: #666;
		}
		#iterations {
			width: 7em;
		}
	</style>
	<script type="text/javascript" src="./sha1.js"></script>
	<script type="text/javascript" src="./pbkdf2.js"></script>
	<script type="text/javascript" src="./passforge.js"></script>
	<script>
		function toggle_progress(elem) {
			var progress = document.getElementById('progressContainer');
			if (elem.checked) {
				//progress.style.visibility = "visible";
				progress.style.display = "block";
			} else {
				//progress.style.visibility = "hidden";
				progress.style.display = "none";
			}
		}

		function set_progress(out_of_100) {
			var progress = document.getElementById('progress');
			progress.style.width = out_of_100 + "%";
		}

		function set_iters(elem) {
			var iters = document.getElementById('iterations')
			if (elem.value == 'custom') {
				iters.disabled = false;
				iters.focus();
				iters.select();
			} else {
				iters.disabled = true;
				iters.value = elem.value;
			}
		}


		var status_callback = function(percent_done) {
			set_progress(percent_done);
		};

		var result_callback = function(key, elapsed) {
			set_progress(100);
			var text = "created in " + elapsed + "s";
			document.getElementById("time").innerHTML = text;

			var keyInput = document.getElementById('key');
			keyInput.value = key;
			keyInput.focus();
			keyInput.select();

			document.getElementById('form').submit.disabled = false;
		};

		function run() {
			var form = document.getElementById('form');
			form.submit.disabled = true;

			passforge.length = form.length.value;
			passforge.iterations = form.iterations.value;
			passforge.status_callback = status_callback;
			passforge.return_callback = result_callback;

			passforge.pwgen(form.nickname.value,
			                form.password.value,
					        form.salt.value,
							form.progress.checked);
		}

	</script>
</head>
<body>
	<form id="form">
		<table>
			<tr>
				<td>password</td>
				<td><input type="text" name="password" value="mypassword" /></td>
			</tr>
			<tr>
				<td>nickname</td>
				<td><input type="text" name="nickname" value="AMZN" /></td>
			</tr>
			<tr>
				<td>salt</td>
				<td><input type="text" name="salt" value="saltines" /></td>
			</tr>
			<tr>
				<td>strengthening factor</td>
				<td>
					<select name="strengthening" onchange="set_iters(this)">
						<option value="1000">low</option>
						<option value="4097" selected=1>medium</option>
						<option value="10000">high</option>
						<option value="100000">paranoid</option>
						<option value="custom">custom</option>
					</select>
					<input type="text" id="iterations" name="iterations" value="4097" disabled=1 />
				</td>
			</tr>
			<tr>
				<td>length</td>
				<td><input type="text" name="length" value="10" /></td>
			</tr>
		</table>
		<label><input type="checkbox" name="progress" checked=1 onclick="toggle_progress(this)" />show progress</label>

		<br />
		<input type="submit" name="submit" value="Create" onclick="run(); return false" />
		<br /><br />
		<div id="progressContainer"><div id="progress">&nbsp;</div></div>
		<div id="status"></div>
		<input type="text" id="key" />
		<div id="time"></div>
	</form>
</body>
</html>
